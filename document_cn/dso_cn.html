<!DOCTYPE html><html lang="cn" dir="ltr" class="no-js" data-env="dev-env"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="Designed by 阿里云UED AX"><meta name="robots" content="index, follow"><link rel="dns-prefetch" href="//"><link rel="dns-prefetch" href="//"><link rel="shortcut icon" href="///favicon.ico?v=s&t=20150120-2R"><title>动态加载模块 - The Tengine Web Server</title><meta name="description" content="&amp;#x63CF;&amp;#x8FF0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8FD0;&amp;#x884C;&amp;#x65F6;&amp;#x52A8;&amp;#x6001;&amp;#x52A0;&amp;#x8F7D;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x7528;&amp;#x6BCF;"><meta property="og:type" content="article"><meta property="og:title" content="动态加载模块"><meta property="og:url" content="http://tengine.taobao.org/document_cn/dso_cn.html"><meta property="og:site_name" content="The Tengine Web Server"><meta property="og:description" content="&amp;#x63CF;&amp;#x8FF0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8FD0;&amp;#x884C;&amp;#x65F6;&amp;#x52A8;&amp;#x6001;&amp;#x52A0;&amp;#x8F7D;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x7528;&amp;#x6BCF;"><meta property="og:updated_time" content="2016-12-02T01:15:20.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="动态加载模块"><meta name="twitter:description" content="&amp;#x63CF;&amp;#x8FF0;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6A21;&amp;#x5757;&amp;#x4E3B;&amp;#x8981;&amp;#x662F;&amp;#x7528;&amp;#x6765;&amp;#x8FD0;&amp;#x884C;&amp;#x65F6;&amp;#x52A8;&amp;#x6001;&amp;#x52A0;&amp;#x8F7D;&amp;#x6A21;&amp;#x5757;&amp;#xFF0C;&amp;#x800C;&amp;#x4E0D;&amp;#x7528;&amp;#x6BCF;"><link rel="alternate" href="/atom.xml" title="The Tengine Web Server" type="application/atom+xml"><link rel="stylesheet" href="/css/bootstrap.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/main.css"></head><body class="page-is-loading"><div class="fluid-container global-header"><div class="container"><div class="header clearfix"><nav><ul class="nav nav-pills pull-right"><li role="presentation"><a href="/download.html">下载</a></li><li role="presentation"><a href="/source.html">源码</a></li><li role="presentation"><a href="/documentation.html">文档</a></li><li role="presentation"><a href="/faq.html">FAQ</a></li><li role="presentation"><a href="/contact.html">联系我们</a></li><li role="presentation"><a href="http://tengine.taobao.org/book/">教程</a></li><li role="presentation" class="hide"><a href="#"><i class="fa fa-bars" aria-hidden="true"></i></a></li></ul></nav><h1 class="text-muted site-logo"><a href="/" id="logo">The Tengine Web Server</a></h1></div></div></div><div class="outer"><section id="main"><div class="fluid-container"><div class="container"><article id="post-document_cn/dso_cn" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">动态加载模块</h1></header><div class="article-entry" itemprop="articleBody"><h2 id="&#x63CF;&#x8FF0;"><a href="#&#x63CF;&#x8FF0;" class="headerlink" title="&#x63CF;&#x8FF0;"></a>&#x63CF;&#x8FF0;</h2><ul><li><p>&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x6A21;&#x5757;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;Tengine.</p></li><li><p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8981;&#x7F16;&#x8BD1;&#x5B98;&#x65B9;&#x6A21;&#x5757;&#x4E3A;&#x52A8;&#x6001;&#x6A21;&#x5757;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5728;configure&#x7684;&#x65F6;&#x5019;&#x52A0;&#x4E0A;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684;&#x6307;&#x4EE4;(&#x2013;with-http_xxx_module),./configure &#x2013;help&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x66F4;&#x591A;&#x7684;&#x7EC6;&#x8282;.</p></li><li><p>&#x5982;&#x679C;&#x53EA;&#x60F3;&#x8981;&#x5B89;&#x88C5;&#x5B98;&#x65B9;&#x6A21;&#x5757;&#x4E3A;&#x52A8;&#x6001;&#x6A21;&#x5757;(&#x4E0D;&#x5B89;&#x88C5;Nginx)&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EA;&#x9700;&#x8981;configure&#x4E4B;&#x540E;&#xFF0C;&#x6267;&#x884C; make dso_install&#x547D;&#x4EE4;.</p></li><li><p>&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x6A21;&#x5757;&#x7684;&#x4E2A;&#x6570;&#x9650;&#x5236;&#x4E3A;128&#x4E2A;.</p></li><li><p>&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x7684;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x6709;&#x4FEE;&#x6539;&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x987B;&#x91CD;&#x8D77;Tengine&#x624D;&#x4F1A;&#x751F;&#x6548;.</p></li><li><p>&#x53EA;&#x652F;&#x6301;HTTP&#x6A21;&#x5757;.</p></li><li><p>&#x6A21;&#x5757; &#x5728;Linux/FreeeBSD/MacOS&#x4E0B;&#x6D4B;&#x8BD5;&#x6210;&#x529F;.</p></li></ul><h2 id="&#x4F8B;&#x5B50;"><a href="#&#x4F8B;&#x5B50;" class="headerlink" title="&#x4F8B;&#x5B50;"></a>&#x4F8B;&#x5B50;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">worker_processes  1;</div><div class="line"></div><div class="line">dso {</div><div class="line">load ngx_http_lua_module.so;</div><div class="line">load ngx_http_memcached_module.so;</div><div class="line">}</div><div class="line"></div><div class="line">events {</div><div class="line">worker_connections  1024;</div><div class="line">}</div></pre></td></tr></table></figure><h2 id="&#x6307;&#x4EE4;"><a href="#&#x6307;&#x4EE4;" class="headerlink" title="&#x6307;&#x4EE4;"></a>&#x6307;&#x4EE4;</h2><p><strong>Syntax</strong>: <em>path path</em></p><p><strong>Default</strong>: <em>none</em></p><p><strong>Context</strong>: <em>dso</em></p><p>path &#x4E3B;&#x8981;&#x662F;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x8DEF;&#x5F84;&#x3002;</p><p>&#x4F8B;&#x5B50;:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">path /home/dso/module/;</div></pre></td></tr></table></figure><p>&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x52A0;&#x8F7D;&#x8DEF;&#x5F84;&#x4E3A;/home/dso/module/.</p><p><strong>Syntax</strong>: _load [module_name] [module<em>path]</em></p><p><strong>Default</strong>: <em>none</em></p><p><strong>Context</strong>: <em>dso</em></p><p>load&#x547D;&#x4EE4;&#x7528;&#x4E8E;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;(module_path),&#x5C06;&#x6307;&#x5B9A;&#x7684;&#x6A21;&#x5757;(module_name)&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x5230;Nginx&#x4E2D;&#x3002;&#x5176;&#x4E2D;module_path&#x548C;module_name&#x53EF;&#x4EE5;&#x53EA;&#x5199;&#x4E00;&#x4E2A;,&#x5982;&#x679C;&#x6CA1;&#x6709;module_path&#x53C2;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x9ED8;&#x8BA4;path&#x662F; $(modulename).so.&#x5982;&#x679C;&#x6CA1;&#x6709;module_name&#x53C2;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x9ED8;&#x8BA4;name&#x5C31;&#x662F;module_path&#x5220;&#x9664;&#x6389;&#x201D;.so&#x201D;&#x540E;&#x7F00;.</p><p>&#x5BF9;&#x4E8E;module_path&#x7684;&#x8DEF;&#x5F84;&#x67E5;&#x627E;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x4E25;&#x683C;&#x6309;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x987A;&#x5E8F;&#x7684;</p><p>1 module_path&#x6307;&#x5B9A;&#x7684;&#x662F;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;<br>2 &#x76F8;&#x5BF9;&#x4E8E;dso_path&#x8BBE;&#x7F6E;&#x7684;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;.<br>3 &#x76F8;&#x5BF9;&#x4E8E;&#x9ED8;&#x8BA4;&#x7684;&#x52A0;&#x8F7D;&#x8DEF;&#x5F84;&#x7684;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;(NGX_PREFIX/modules&#x6216;&#x8005;&#x8BF4;configure&#x65F6;&#x901A;&#x8FC7;&#x2013;dso-path&#x8BBE;&#x7F6E;&#x7684;&#x8DEF;&#x5F84;).</p><p>&#x4F8B;&#x5B50;:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">load ngx_http_empty_gif_module  ngx_http_empty_gif_module.so;</div><div class="line">load ngx_http_test_module;</div><div class="line">load ngx_http_test2_module.so;</div></pre></td></tr></table></figure><p>&#x5C06;&#x4F1A;&#x4ECE;ngx_http_empty_gif_module.so.&#x52A0;&#x8F7D;empty_gif&#x6A21;&#x5757;&#x3002;&#x4EE5;&#x53CA;&#x4ECE;ngx_http_test_module.so&#x52A0;&#x8F7D;ngx_http_test_module&#x6A21;&#x5757;.&#x7B2C;&#x4E09;&#x6761;&#x6307;&#x4EE4;&#x662F;&#x4ECE;ngx_http_test2_module.so&#x52A0;&#x8F7D;ngx_http_test2_module&#x6A21;&#x5757;.</p><p><strong>Syntax</strong>: _module_stub module<em>name</em></p><p><strong>Default</strong>: <em>none</em></p><p><strong>Context</strong>: <em>dso</em></p><p>&#x8FD9;&#x4E2A;&#x6307;&#x4EE4;&#x4E3B;&#x8981;&#x662F;&#x5C06;&#x4F60;&#x9700;&#x8981;&#x7684;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x63D2;&#x5165;&#x5230;&#x4F60;&#x6240;&#x9700;&#x8981;&#x7684;&#x4F4D;&#x7F6E;(&#x53EF;&#x4EE5;&#x770B;conf/module_stubs&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;),&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x8981;&#x5F88;&#x5C0F;&#x5FC3;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C06;&#x4F1A;&#x6539;&#x53D8;&#x4F60;&#x7684;&#x6A21;&#x5757;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x987A;&#x5E8F;(&#x5728;Nginx&#x4E2D;&#x6A21;&#x5757;&#x90FD;&#x662F;&#x6709;&#x4E25;&#x683C;&#x987A;&#x5E8F;&#x7684;).&#x800C;&#x5927;&#x591A;&#x6570;&#x65F6;&#x5019;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x90FD;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x7684;&#x3002;</p><p>&#x4F8B;&#x5B50;:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">module_stub ngx_core_module;</div><div class="line">module_stub ngx_errlog_module;</div><div class="line">module_stub ngx_conf_module;</div><div class="line">module_stub ngx_events_module;</div><div class="line">module_stub ngx_event_core_module;</div><div class="line">module_stub ngx_epoll_module;</div><div class="line">module_stub ngx_openssl_module;</div><div class="line">module_stub ngx_http_module;</div><div class="line">module_stub ngx_http_core_module;</div><div class="line">.......................</div><div class="line">module_stub ngx_http_addition_filter_module;</div><div class="line">module_stub ngx_http_my_filter_module;</div></pre></td></tr></table></figure><p>&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5C06;&#x4F1A;&#x63D2;&#x5165;my_filter&#x6A21;&#x5757;&#x5230;addition_filter&#x4E4B;&#x524D;&#x6267;&#x884C;&#x3002;</p><p><strong>Syntax</strong>: _include file<em>name</em></p><p><strong>Default</strong>: <em>none</em></p><p><strong>Context</strong>: <em>dso</em></p><p>include&#x547D;&#x4EE4;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x5BF9;&#x5E94;&#x6A21;&#x5757;&#x987A;&#x5E8F;(module_stub&#x6307;&#x4EE4;),&#x6709;&#x5173;&#x4E8E;module_stub&#x6307;&#x4EE4;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;&#x9762;&#x7684;module_stubs&#x90E8;&#x5206;.</p><p>&#x4F8B;&#x5B50;:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include module_stubs</div></pre></td></tr></table></figure><p>&#x5C06;&#x4F1A;&#x52A0;&#x8F7D;conf/module_stubs&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E3B;&#x8981;&#x662F;&#x7531;(module_stub&#x6307;&#x4EE4;&#x7EC4;&#x6210;).</p><h2 id="&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x52A8;&#x6001;&#x6A21;&#x5757;"><a href="#&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x52A8;&#x6001;&#x6A21;&#x5757;" class="headerlink" title="&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x52A8;&#x6001;&#x6A21;&#x5757;"></a>&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x52A8;&#x6001;&#x6A21;&#x5757;</h2><p>&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8981;&#x5728;&#x5B89;&#x88C5;&#x5B8C;Tengine&#x4E4B;&#x540E;&#xFF0C;&#x7F16;&#x8BD1;&#x5B98;&#x65B9;&#x6A21;&#x5757;&#x4E3A;&#x52A8;&#x6001;&#x6A21;&#x5757;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x9700;&#x8981;&#x6309;&#x7167;&#x5982;&#x4E0B;&#x7684;&#x6B65;&#x9AA4;:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">*   &#x5728;configure&#x7684;&#x65F6;&#x5019;&#x6253;&#x5F00;&#x4F60;&#x60F3;&#x8981;&#x7F16;&#x8BD1;&#x7684;&#x6A21;&#x5757;.</div><div class="line">$ ./configure --with-http_sub_module=shared</div><div class="line">*   &#x7F16;&#x8BD1;&#x5B83;.</div><div class="line">$ make</div><div class="line">*   &#x5B89;&#x88C5;&#x52A8;&#x6001;&#x6A21;&#x5757;.</div><div class="line">$ make dso_install</div></pre></td></tr></table></figure><p>&#x5B83;&#x5C06;&#x4F1A;&#x590D;&#x5236;&#x52A8;&#x6001;&#x5E93;&#x6587;&#x4EF6;&#x5230;&#x4F60;&#x7684;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x76EE;&#x5F55;&#xFF0C;&#x6216;&#x8005;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x624B;&#x5DE5;&#x62F7;&#x8D1D;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x6587;&#x4EF6;(&#x6587;&#x4EF6;&#x662F;&#x5728;objs/modules)&#x5230;&#x4F60;&#x60F3;&#x8981;&#x52A0;&#x8F7D;&#x7684;&#x76EE;&#x5F55;.</p><p>&#x4F60;&#x80FD;&#x591F;&#x4F7F;&#x7528;dso_tool(&#x5728;Nginx&#x5B89;&#x88C5;&#x76EE;&#x5F55;&#x7684;sbin&#x4E0B;)&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x6765;&#x7F16;&#x8BD1;&#x7B2C;&#x4E09;&#x65B9;&#x6A21;&#x5757;.</p><p>&#x4F8B;&#x5B50;:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./dso_tool --add-module=/home/dso/lua-nginx-module</div></pre></td></tr></table></figure><p>&#x5C06;&#x4F1A;&#x7F16;&#x8BD1;ngx_lua&#x6A21;&#x5757;&#x4E3A;&#x52A8;&#x6001;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x5B89;&#x88C5;&#x5230;&#x9ED8;&#x8BA4;&#x7684;&#x6A21;&#x5757;&#x8DEF;&#x5F84;.&#x5982;&#x679C;&#x4F60;&#x60F3;&#x8981;&#x5B89;&#x88C5;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x2013;dst&#x9009;&#x9879;(&#x66F4;&#x591A;&#x7684;&#x9009;&#x9879;&#x8BF7;&#x4F7F;&#x7528;dso_tool -h&#x67E5;&#x770B;).</p></div></div></article></div></div></section></div><div class="fluid-container global-footer"><div class="container"><div class="row"><div class="col-lg-6"><div class="footer-logo"></div></div><div class="col-lg-6 clearfix"><select class="lang-switch pull-right"></select></div></div><div class="row"><div class="col-lg-12"><span class="footer-text copyright">&copy; 2011-2016 Alibaba Inc. All rights reserved.</span> <span class="footer-text design-by">Designed by 阿里云UED AX</span></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/bootstrap.js"></script><script src="/js/particles.min.js"></script><script src="/js/app.js"></script></body></html>