<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The Tengine Web Server</title>
  <link rel="stylesheet" type="text/css" href="../style.css">
  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6614032-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  function correctPNG()
  {
    var arVersion = navigator.appVersion.split("MSIE");
    var version = parseFloat(arVersion[1]);
    if ((version == 5.5 || version == 6) && (document.body.filters))
    {
      for(var j=0; j<document.images.length; j++)
      {
        var img = document.images[j];
        var imgName = img.src.toUpperCase();
        if (imgName.substring(imgName.length-3, imgName.length) == "PNG")
        {
          var imgID = (img.id) ? "id='" + img.id + "' " : "";
          var imgClass = (img.className) ? "class='" + img.className + "' " : "";
          var imgTitle = (img.title) ? "title='" + img.title + "' " : "title='" + img.alt + "' ";
          var imgStyle = "display:inline-block;" + img.style.cssText;
          if (img.align == "left") imgStyle = "float:left;" + imgStyle;
          if (img.align == "right") imgStyle = "float:right;" + imgStyle;
          if (img.parentElement.href) imgStyle = "cursor:hand;" + imgStyle;
          var strNewHTML = "<span " + imgID + imgClass + imgTitle
          + " style=\"" + "width:" + img.width + "px; height:" + img.height + "px;" + imgStyle + ";"
          + "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader"
          + "(src=\'" + img.src + "\', sizingMethod='scale');\"></span>";
          img.outerHTML = strNewHTML;
          j = j - 1;
        }
      }
    }
  }
  window.attachEvent("onload", correctPNG);
  </script>
</head>

<body>
<div id="container">
  <div id="menu">
    <ul>
      <li><a href="../download.html"><img src="../images/icon-down.png"/>Download</a></li>
      <li><a href="../source.html"><img src="../images/icon_code.png"/>Source</a></li>
      <li><a href="../documentation.html"><img src="../images/icon-doc.png"/>Documentation</a></li>
      <li><a href="#"><img src="../images/icon-faq.png"/>FAQ</a></li>
      <li><a href="../contact.html"><img src="../images/icon-contact.png"/>Contact</a></li>
	    <li id="lang"><a href="../index_cn.html">中文</a> | <a href="../index.html">English</a></li>
    </ul>
  </div>
  <div id="logo"><a href="../index.html"><img src="../images/logo.png" alt="tengine" /></a></div>
  <div class="clear"></div>
  <div class="one_col more_padding font16">
    <div class="module">ngx_http_headers_module</div>
    <div class="mod_intro"><p> We enhance the original nginx http headers module. We add the 'expires_by_types' directive. It can set the expires time by the response type. The original module is <a href="http://wiki.nginx.org/HttpHeadersModule" target="_blank">here</a>.
	<div class="dh">Examples</div>
<pre class="mod_example">
    expires_by_types       24h text/html;
    expires_by_types       modified +24h text/xml;
    expires_by_types       @15h30m text/xml;
    expires_by_types       0 text/xml;
    expires_by_types       -1 text/xml;
    expires_by_types       epoch text/xml;
</pre></p>
    </div>
    <div class="dh">Directive</div>
    <div class="directive">
Syntax: expires_by_types [[modified] time | @time-of-day | epoch | max | off] content-type1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[content-type2] [content-type3] ...<br/>
Default: none<br/>
Context: http, server, location
    </div>
    <div class="introduce">
<p>This directive can specify the content-type and its expires time. The expires time format is similar to the original 'expires' directive. You can add one or more content-type after the parameter of expires time. </p>
<p>You should note that, when both 'expires' and 'expires_by_types' appear, the priority rules are here:
<ul>
<li>Rule 1: in the same block level, If both 'expires' and 'expires_by_types' appear, the precisely matched content-type and its expire time in the directive of 'expires_by_type' will be chosen. If the content-type is not matched, the expire time in the directive of 'expires' will be chosen. </li>
<li>Rule 2: if we don't set the directive 'expires' or 'expries_by_types' in current block. All the expires configure will be inherited from the parent block. Other rules will follow the above rule.</li>
<li>Rule 3: if we specify the 'expires off' in current block, both the directive 'expires' and 'expires_by_types' will be disabled.</li>
<li>Rule 4: if we don't specify the 'expires off' in current block, but we specify 'expires off' in the parent block. The directve of 'expires_by_types' in current block will still be enabled. </li>
</ul>
<br />
For example:
<pre class="mod_example">
    location /url {
        expires                10s;
        expires_by_types       24s text/html;
    }
</pre>
The expires time with the content-type of 'text/html' is 24 seconds in the directory of "/url", others will be 10 seconds. 
<pre class="mod_example">
    expires                    10s;
    expires_by_types           24s text/html;

    location /url {
        expires_by_types       20s text/rss;
    }
</pre class="mod_example">
The expire time with the content-type of 'text/html' is 24 seconds in the directory of "/url", others will be 10 seconds. That's because the directive of 'expires_by_types' in parent block is overwritten by current block. But the directive of 'expires' is inherited from parent block.
<pre class="mod_example">
    expires                    10s;
    expires_by_types           24s text/html;

    location /url {
        expires off;
        expires_by_types       20s text/rss;
    }
</pre>
All the resposne will not be expired in the directory of "/url". See rule 3.
<pre class="mod_example">
    expires off;
    expires_by_types           24s text/html;

    location /url {
        expires_by_types       20s text/rss;
    }
</pre>
The expire time with the content-type of 'text/html' is 20 seconds in the directory of "/url". Others will not be expired. Because the 'expires off' will not inherited. See rule 4.
</p>
    </div>
  </div>
</div>
<div id="copyright">&copy; 2011-2012 Taobao Inc. All rights reserved.</div>
</body>
</html>
